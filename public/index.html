<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Noqeder ¬∑ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</title>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #0a0a0c;
      color: #fff;
      height: 100vh;
      overflow: hidden;
    }

    /* ==================== –ê–ù–ò–ú–ê–¶–ò–ò ==================== */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideIn {
      from { transform: translateX(-20px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    /* ==================== –õ–û–ì–û–¢–ò–ü ==================== */
    .logo {
      text-align: center;
      margin-bottom: 40px;
    }

    .logo span {
      display: inline-block;
      font-size: 48px;
      font-weight: 800;
      letter-spacing: 4px;
      color: #fff;
      background: #000;
      padding: 8px 24px;
      border-radius: 60px;
      border: 2px solid #fff;
      animation: pulse 2s infinite;
    }

    /* ==================== –ß–ï–†–ù–û-–ë–ï–õ–´–ï –ò–ö–û–ù–ö–ò ==================== */
    .icon-btn {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: #1a1a24;
      border: 2px solid #2a2a35;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      font-size: 20px;
      color: #fff;
      filter: grayscale(100%);
    }

    .icon-btn:hover {
      background: #fff;
      color: #000;
      border-color: #fff;
      transform: scale(1.1) rotate(5deg);
      filter: grayscale(0%);
      box-shadow: 0 0 20px rgba(255,255,255,0.3);
    }

    .icon-btn.rotating:hover {
      animation: rotate 0.5s ease;
    }

    .icon-btn.active {
      background: #fff;
      color: #000;
      filter: grayscale(0%);
    }

    .media-btn {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: #1a1a24;
      border: 2px solid #2a2a35;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 20px;
      color: #fff;
      filter: grayscale(100%);
    }

    .media-btn:hover {
      background: #fff;
      color: #000;
      border-color: #fff;
      transform: scale(1.1) rotate(5deg);
      filter: grayscale(0%);
      box-shadow: 0 0 20px rgba(255,255,255,0.3);
    }

    /* ==================== –ê–í–ê–¢–ê–†–ö–ò ==================== */
    .avatar-upload {
      margin-bottom: 24px;
      text-align: center;
    }

    .avatar-preview {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: #1a1a24;
      border: 3px solid #2a2a35;
      margin: 0 auto 12px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }

    .avatar-preview:hover {
      border-color: #fff;
      transform: scale(1.05);
      box-shadow: 0 0 30px rgba(255,255,255,0.2);
    }

    .avatar-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .avatar-placeholder {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #666;
      font-size: 24px;
      background: #1a1a24;
    }

    .user-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: #1a1a24;
      border: 2px solid #2a2a35;
      overflow: hidden;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .user-avatar:hover {
      border-color: #fff;
      transform: scale(1.1) rotate(5deg);
    }

    .user-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .user-avatar.small {
      width: 36px;
      height: 36px;
    }

    .user-avatar.large {
      width: 80px;
      height: 80px;
    }

    .user-avatar.favorite {
      border-color: #ffd700;
      box-shadow: 0 0 10px #ffd700;
    }

    .message-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: #1a1a24;
      border: 2px solid #2a2a35;
      overflow: hidden;
      transition: all 0.3s ease;
      flex-shrink: 0;
      cursor: pointer;
    }

    .message-avatar:hover {
      border-color: #fff;
      transform: scale(1.1);
    }

    .message-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* ==================== –≠–ö–†–ê–ù –í–•–û–î–ê ==================== */
    .welcome-screen {
      position: fixed;
      inset: 0;
      background: #0a0a0c;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      animation: fadeIn 0.5s ease;
    }

    .hidden {
      display: none !important;
    }

    .auth-card {
      width: 400px;
      padding: 32px;
      background: #12121a;
      border: 2px solid #2a2a35;
      border-radius: 32px;
      text-align: center;
      animation: slideIn 0.5s ease;
    }

    .input-group {
      margin-bottom: 20px;
      text-align: left;
    }

    .input-group label {
      display: block;
      margin-bottom: 8px;
      color: #888;
      font-size: 12px;
      font-weight: 500;
      letter-spacing: 0.5px;
    }

    .input-group input,
    .input-group textarea {
      width: 100%;
      padding: 16px;
      background: #0f0f15;
      border: 2px solid #2a2a35;
      border-radius: 16px;
      color: #fff;
      font-size: 16px;
      outline: none;
      transition: all 0.3s ease;
      font-family: inherit;
    }

    .input-group textarea {
      min-height: 80px;
      resize: vertical;
    }

    .input-group input:focus,
    .input-group textarea:focus {
      border-color: #fff;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(255,255,255,0.1);
    }

    .btn {
      width: 100%;
      padding: 16px;
      background: #fff;
      color: #000;
      border: none;
      border-radius: 16px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 20px;
      transition: all 0.3s ease;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(255,255,255,0.2);
    }

    .btn.small {
      padding: 12px;
      font-size: 14px;
      margin-top: 10px;
    }

    /* ==================== –û–°–ù–û–í–ù–û–ô –ß–ê–¢ ==================== */
    .chat-container {
      display: grid;
      grid-template-columns: 360px 1fr;
      height: 100vh;
      animation: fadeIn 0.5s ease;
    }

    .chats-sidebar {
      background: #12121a;
      border-right: 2px solid #2a2a35;
      padding: 20px;
      overflow-y: auto;
    }

    .sidebar-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
    }

    .sidebar-header h2 span {
      background: #000;
      padding: 4px 12px;
      border-radius: 40px;
      border: 2px solid #fff;
      font-size: 20px;
    }

    /* ==================== –ö–ê–†–¢–û–ß–ö–ê –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø ==================== */
    .user-card {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 16px;
      background: #1a1a24;
      border-radius: 20px;
      margin-bottom: 24px;
      border: 2px solid #2a2a35;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .user-card:hover {
      border-color: #fff;
      transform: translateX(5px);
    }

    .user-info {
      flex: 1;
    }

    .user-name {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .user-username {
      font-size: 14px;
      color: #888;
      margin-bottom: 4px;
    }

    .user-bio {
      font-size: 12px;
      color: #666;
      display: flex;
      align-items: center;
      gap: 4px;
      margin-top: 4px;
    }

    .user-music {
      font-size: 12px;
      color: #4ade80;
      display: flex;
      align-items: center;
      gap: 4px;
      margin-top: 4px;
    }

    /* ==================== –ò–ó–ë–†–ê–ù–ù–û–ï ==================== */
    .favorites-section {
      margin-bottom: 24px;
    }

    .favorites-title {
      color: #888;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .favorites-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .favorite-item {
      display: flex;
      align-items: center;
      padding: 12px;
      background: #1a1a24;
      border-radius: 16px;
      border: 2px solid #2a2a35;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .favorite-item:hover {
      border-color: #ffd700;
      transform: translateX(5px);
    }

    .favorite-star {
      color: #ffd700;
      font-size: 16px;
      margin-right: 8px;
    }

    /* ==================== –ù–ê–°–¢–†–û–ô–ö–ò ==================== */
    .settings-modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.9);
      width: 500px;
      max-height: 80vh;
      overflow-y: auto;
      background: #12121a;
      border: 2px solid #2a2a35;
      border-radius: 32px;
      padding: 32px;
      z-index: 2000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .settings-modal.active {
      opacity: 1;
      visibility: visible;
      transform: translate(-50%, -50%) scale(1);
    }

    .settings-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.8);
      z-index: 1999;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .settings-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .settings-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
    }

    .settings-header h3 {
      font-size: 24px;
    }

    .settings-section {
      margin-bottom: 24px;
    }

    .settings-section-title {
      font-size: 12px;
      color: #888;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 12px;
    }

    .settings-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px;
      background: #1a1a24;
      border: 2px solid #2a2a35;
      border-radius: 16px;
      margin-bottom: 8px;
    }

    .settings-item-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .settings-item-icon {
      font-size: 20px;
      filter: grayscale(100%);
    }

    .settings-item-info h4 {
      font-size: 14px;
      margin-bottom: 2px;
    }

    .settings-item-info p {
      font-size: 12px;
      color: #888;
    }

    .settings-toggle {
      width: 44px;
      height: 24px;
      background: #2a2a35;
      border-radius: 30px;
      position: relative;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .settings-toggle.active {
      background: #fff;
    }

    .settings-toggle:after {
      content: '';
      width: 20px;
      height: 20px;
      background: #fff;
      border-radius: 50%;
      position: absolute;
      top: 2px;
      left: 2px;
      transition: all 0.3s ease;
    }

    .settings-toggle.active:after {
      left: 22px;
      background: #000;
    }

    .settings-select {
      padding: 8px 16px;
      background: #0f0f15;
      border: 2px solid #2a2a35;
      border-radius: 30px;
      color: #fff;
      font-size: 14px;
      outline: none;
    }

    /* ==================== –ü–†–û–§–ò–õ–¨ ==================== */
    .profile-modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.9);
      width: 450px;
      max-height: 80vh;
      overflow-y: auto;
      background: #12121a;
      border: 2px solid #2a2a35;
      border-radius: 32px;
      padding: 32px;
      z-index: 2000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .profile-modal.active {
      opacity: 1;
      visibility: visible;
      transform: translate(-50%, -50%) scale(1);
    }

    .profile-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.8);
      z-index: 1999;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .profile-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .profile-header {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-bottom: 24px;
    }

    .profile-avatar-large {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: #1a1a24;
      border: 3px solid #fff;
      overflow: hidden;
      position: relative;
    }

    .profile-avatar-large img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .favorite-badge {
      position: absolute;
      bottom: 0;
      right: 0;
      background: #ffd700;
      color: #000;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid #fff;
    }

    .profile-title {
      flex: 1;
    }

    .profile-title h3 {
      font-size: 24px;
      margin-bottom: 4px;
    }

    .profile-title .username {
      color: #888;
      font-size: 14px;
      margin-bottom: 8px;
    }

    .favorite-button {
      padding: 6px 12px;
      background: #1a1a24;
      border: 2px solid #2a2a35;
      border-radius: 30px;
      color: #ffd700;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .favorite-button:hover {
      border-color: #ffd700;
      background: #ffd700;
      color: #000;
    }

    .favorite-button.active {
      background: #ffd700;
      color: #000;
      border-color: #ffd700;
    }

    .profile-section {
      margin-bottom: 24px;
    }

    .profile-section-title {
      font-size: 12px;
      color: #888;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 12px;
    }

    .profile-bio {
      background: #1a1a24;
      padding: 16px;
      border-radius: 16px;
      font-size: 14px;
      line-height: 1.6;
      color: #ccc;
      border: 2px solid #2a2a35;
    }

    .profile-music-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: #1a1a24;
      border-radius: 16px;
      border: 2px solid #2a2a35;
      margin-bottom: 8px;
    }

    .music-icon {
      font-size: 24px;
      filter: grayscale(100%);
    }

    .music-info {
      flex: 1;
    }

    .music-title {
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 4px;
    }

    .music-artist {
      font-size: 12px;
      color: #888;
    }

    .music-play {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: #fff;
      border: none;
      cursor: pointer;
    }

    .edit-field {
      margin-bottom: 16px;
    }

    .edit-field label {
      display: block;
      margin-bottom: 8px;
      color: #888;
      font-size: 12px;
    }

    /* ==================== –ü–û–ò–°–ö ==================== */
    .search-section {
      margin-bottom: 24px;
    }

    .search-title {
      color: #888;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 12px;
    }

    .search-container {
      position: relative;
    }

    .search-icon {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: #888;
      font-size: 16px;
      filter: grayscale(100%);
    }

    .search-input {
      width: 100%;
      padding: 14px 14px 14px 48px;
      background: #0f0f15;
      border: 2px solid #2a2a35;
      border-radius: 30px;
      color: #fff;
      font-size: 14px;
      outline: none;
      transition: all 0.3s ease;
    }

    .search-input:focus {
      border-color: #fff;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(255,255,255,0.1);
    }

    .search-results {
      margin-top: 8px;
      max-height: 200px;
      overflow-y: auto;
    }

    .search-result-item {
      display: flex;
      align-items: center;
      padding: 12px;
      background: #1a1a24;
      border-radius: 12px;
      margin-bottom: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      animation: slideIn 0.3s ease;
    }

    .search-result-item:hover {
      background: #2a2a35;
      transform: translateX(5px);
    }

    .search-result-favorite {
      margin-left: 8px;
      color: #ffd700;
      font-size: 14px;
    }

    /* ==================== –ß–ê–¢–´ ==================== */
    .chats-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .chat-item {
      display: flex;
      align-items: center;
      padding: 16px;
      background: #1a1a24;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid transparent;
      animation: slideIn 0.5s ease;
    }

    .chat-item:hover {
      background: #2a2a35;
      transform: translateX(5px);
      border-color: #fff;
    }

    .chat-item.selected {
      border-color: #fff;
      background: #2a2a35;
    }

    .chat-item.favorite {
      border-color: #ffd700;
    }

    .chat-info {
      flex: 1;
      margin-left: 12px;
    }

    .chat-name {
      font-weight: 600;
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .chat-name .star {
      color: #ffd700;
      font-size: 14px;
    }

    .chat-last-message {
      font-size: 13px;
      color: #888;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* ==================== –°–û–û–ë–©–ï–ù–ò–Ø ==================== */
    .chat-main {
      display: flex;
      flex-direction: column;
    }

    .chat-header {
      padding: 20px;
      border-bottom: 2px solid #2a2a35;
      background: #12121a;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
    }

    .header-left .star {
      color: #ffd700;
      font-size: 18px;
    }

    .header-icons {
      display: flex;
      gap: 12px;
    }

    .messages-area {
      flex: 1;
      padding: 24px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .message {
      max-width: 70%;
      display: flex;
      gap: 12px;
      animation: fadeIn 0.3s ease;
    }

    .message.own {
      align-self: flex-end;
    }

    .message-content {
      background: #1a1a24;
      padding: 12px 16px;
      border-radius: 20px;
      word-break: break-word;
      transition: all 0.3s ease;
    }

    .message-content:hover {
      transform: scale(1.02);
    }

    .message.own .message-content {
      background: #fff;
      color: #000;
    }

    .message-author {
      font-size: 12px;
      color: #aaa;
      margin-bottom: 4px;
      font-weight: 600;
      cursor: pointer;
      display: inline-block;
    }

    .message-author:hover {
      text-decoration: underline;
    }

    .message.own .message-author {
      color: #666;
    }

    .message-time {
      font-size: 10px;
      color: #888;
      margin-top: 4px;
      text-align: right;
    }

    /* ==================== –§–ê–ô–õ–´ ==================== */
    .file-message {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      margin: 8px 0;
    }

    .file-icon {
      font-size: 32px;
      filter: grayscale(100%);
      transition: all 0.3s ease;
    }

    .file-message:hover .file-icon {
      filter: grayscale(0%);
      transform: scale(1.1);
    }

    .file-info {
      flex: 1;
    }

    .file-name {
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 4px;
    }

    .file-size {
      font-size: 12px;
      color: #888;
    }

    .file-download {
      padding: 8px 16px;
      background: #fff;
      color: #000;
      border-radius: 30px;
      text-decoration: none;
      font-size: 12px;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .file-download:hover {
      transform: scale(1.05);
      box-shadow: 0 5px 15px rgba(255,255,255,0.2);
    }

    .message-image {
      max-width: 300px;
      max-height: 200px;
      border-radius: 12px;
      cursor: pointer;
      margin-top: 8px;
      transition: all 0.3s ease;
    }

    .message-image:hover {
      transform: scale(1.05);
      box-shadow: 0 5px 20px rgba(255,255,255,0.2);
    }

    .message-video {
      max-width: 300px;
      max-height: 200px;
      border-radius: 12px;
      margin-top: 8px;
    }

    .system-message {
      text-align: center;
      font-size: 12px;
      color: #888;
      padding: 12px;
      background: #1a1a24;
      border-radius: 40px;
      align-self: center;
      animation: fadeIn 0.5s ease;
    }

    /* ==================== –ö–û–ú–ü–û–ó–ï–† ==================== */
    .composer {
      padding: 20px;
      border-top: 2px solid #2a2a35;
      background: #12121a;
    }

    .composer-tools {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }

    .composer-row {
      display: flex;
      gap: 12px;
    }

    .composer input {
      flex: 1;
      padding: 16px 20px;
      background: #0f0f15;
      border: 2px solid #2a2a35;
      border-radius: 30px;
      color: #fff;
      outline: none;
      transition: all 0.3s ease;
    }

    .composer input:focus {
      border-color: #fff;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(255,255,255,0.1);
    }

    .composer button {
      width: 54px;
      height: 54px;
      border-radius: 50%;
      border: none;
      background: #fff;
      cursor: pointer;
      font-size: 24px;
      transition: all 0.3s ease;
    }

    .composer button:hover {
      transform: scale(1.1) rotate(5deg);
      box-shadow: 0 5px 20px rgba(255,255,255,0.3);
    }

    /* ==================== –ü–†–ï–í–¨–Æ –§–ê–ô–õ–ê ==================== */
    .upload-preview {
      margin-top: 12px;
      padding: 12px;
      background: #1a1a24;
      border: 2px solid #2a2a35;
      border-radius: 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      animation: slideIn 0.3s ease;
    }

    .upload-preview.hidden {
      display: none;
    }

    .preview-info {
      flex: 1;
    }

    .preview-name {
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 4px;
    }

    .preview-size {
      font-size: 12px;
      color: #888;
    }

    .preview-cancel {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #ff4444;
      color: white;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .preview-cancel:hover {
      transform: scale(1.1) rotate(90deg);
    }
  </style>
</head>
<body>

<!-- –û–≤–µ—Ä–ª–µ–π –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
<div class="settings-overlay" id="settingsOverlay" onclick="closeSettings()"></div>
<div class="settings-modal" id="settingsModal">
  <div class="settings-header">
    <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
    <div class="icon-btn rotating" onclick="closeSettings()">‚úï</div>
  </div>

  <!-- –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å -->
  <div class="settings-section">
    <div class="settings-section-title">–ö–û–ù–§–ò–î–ï–ù–¶–ò–ê–õ–¨–ù–û–°–¢–¨</div>
    <div class="settings-item">
      <div class="settings-item-left">
        <span class="settings-item-icon">üëÅÔ∏è</span>
        <div class="settings-item-info">
          <h4>–ö—Ç–æ –≤–∏–¥–∏—Ç –º–æ–π –æ–Ω–ª–∞–π–Ω</h4>
          <p>–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å "–≤ —Å–µ—Ç–∏"</p>
        </div>
      </div>
      <select class="settings-select" id="privacyOnline">
        <option value="all">–í—Å–µ</option>
        <option value="contacts">–¢–æ–ª—å–∫–æ –∫–æ–Ω—Ç–∞–∫—Ç—ã</option>
        <option value="none">–ù–∏–∫—Ç–æ</option>
      </select>
    </div>

    <div class="settings-item">
      <div class="settings-item-left">
        <span class="settings-item-icon">üìû</span>
        <div class="settings-item-info">
          <h4>–ö—Ç–æ –º–æ–∂–µ—Ç –º–Ω–µ –∑–≤–æ–Ω–∏—Ç—å</h4>
          <p>–†–∞–∑—Ä–µ—à–∏—Ç—å –∑–≤–æ–Ω–∫–∏ –æ—Ç</p>
        </div>
      </div>
      <select class="settings-select" id="privacyCalls">
        <option value="all">–í—Å–µ</option>
        <option value="contacts">–¢–æ–ª—å–∫–æ –∫–æ–Ω—Ç–∞–∫—Ç—ã</option>
        <option value="none">–ù–∏–∫—Ç–æ</option>
      </select>
    </div>

    <div class="settings-item">
      <div class="settings-item-left">
        <span class="settings-item-icon">üí¨</span>
        <div class="settings-item-info">
          <h4>–ö—Ç–æ –º–æ–∂–µ—Ç –ø–∏—Å–∞—Ç—å</h4>
          <p>–†–∞–∑—Ä–µ—à–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç</p>
        </div>
      </div>
      <select class="settings-select" id="privacyMessages">
        <option value="all">–í—Å–µ</option>
        <option value="contacts">–¢–æ–ª—å–∫–æ –∫–æ–Ω—Ç–∞–∫—Ç—ã</option>
        <option value="none">–ù–∏–∫—Ç–æ</option>
      </select>
    </div>
  </div>

  <!-- –ó–≤–æ–Ω–∫–∏ -->
  <div class="settings-section">
    <div class="settings-section-title">–ó–í–û–ù–ö–ò</div>
    <div class="settings-item">
      <div class="settings-item-left">
        <span class="settings-item-icon">üé§</span>
        <div class="settings-item-info">
          <h4>–ú–∏–∫—Ä–æ—Ñ–æ–Ω</h4>
          <p>–†–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É</p>
        </div>
      </div>
      <div class="settings-toggle active" id="micToggle" onclick="toggleSetting('mic')"></div>
    </div>

    <div class="settings-item">
      <div class="settings-item-left">
        <span class="settings-item-icon">üîä</span>
        <div class="settings-item-info">
          <h4>–ó–≤—É–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</h4>
          <p>–ó–≤—É–∫ –ø—Ä–∏ –∑–≤–æ–Ω–∫–∞—Ö</p>
        </div>
      </div>
      <div class="settings-toggle active" id="soundToggle" onclick="toggleSetting('sound')"></div>
    </div>

    <div class="settings-item">
      <div class="settings-item-left">
        <span class="settings-item-icon">üìπ</span>
        <div class="settings-item-info">
          <h4>–ê–≤—Ç–æ–æ—Ç–≤–µ—Ç—á–∏–∫</h4>
          <p>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–≤–æ–Ω–∫–∏</p>
        </div>
      </div>
      <div class="settings-toggle" id="autoAcceptToggle" onclick="toggleSetting('autoAccept')"></div>
    </div>
  </div>

  <!-- –Ø–∑—ã–∫ -->
  <div class="settings-section">
    <div class="settings-section-title">–Ø–ó–´–ö</div>
    <div class="settings-item">
      <div class="settings-item-left">
        <span class="settings-item-icon">üåê</span>
        <div class="settings-item-info">
          <h4>–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</h4>
          <p>–í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫</p>
        </div>
      </div>
      <select class="settings-select" id="languageSelect">
        <option value="ru">–†—É—Å—Å–∫–∏–π</option>
        <option value="en">English</option>
        <option value="uk">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</option>
      </select>
    </div>
  </div>

  <!-- –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è -->
  <div class="settings-section">
    <div class="settings-section-title">–ü–ï–†–°–û–ù–ê–õ–ò–ó–ê–¶–ò–Ø</div>
    <div class="settings-item">
      <div class="settings-item-left">
        <span class="settings-item-icon">üé®</span>
        <div class="settings-item-info">
          <h4>–¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞</h4>
          <p>–¢—ë–º–Ω–∞—è —Ç–µ–º–∞</p>
        </div>
      </div>
      <select class="settings-select" id="themeSelect">
        <option value="dark">–¢—ë–º–Ω–∞—è</option>
        <option value="light">–°–≤–µ—Ç–ª–∞—è</option>
      </select>
    </div>

    <div class="settings-item">
      <div class="settings-item-left">
        <span class="settings-item-icon">üîî</span>
        <div class="settings-item-info">
          <h4>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h4>
          <p>–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</p>
        </div>
      </div>
      <div class="settings-toggle active" id="notificationsToggle" onclick="toggleSetting('notifications')"></div>
    </div>

    <div class="settings-item">
      <div class="settings-item-left">
        <span class="settings-item-icon">üí´</span>
        <div class="settings-item-info">
          <h4>–ê–Ω–∏–º–∞—Ü–∏–∏</h4>
          <p>–ü–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã</p>
        </div>
      </div>
      <div class="settings-toggle active" id="animationsToggle" onclick="toggleSetting('animations')"></div>
    </div>
  </div>

  <button class="btn small" onclick="saveSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
  <button class="btn small" onclick="closeSettings()" style="margin-top: 10px; background: #333; color: #fff;">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>

<!-- –û–≤–µ—Ä–ª–µ–π –ø—Ä–æ—Ñ–∏–ª—è -->
<div class="profile-overlay" id="profileOverlay" onclick="closeProfileModal()"></div>
<div class="profile-modal" id="profileModal">
  <div class="profile-header">
    <div class="profile-avatar-large" id="modalAvatar">
      <img src="" id="modalAvatarImg">
      <div class="favorite-badge" id="modalFavoriteBadge" style="display: none;">‚≠ê</div>
    </div>
    <div class="profile-title">
      <h3 id="modalName">moowie</h3>
      <div class="username" id="modalUsername">@moowie</div>
      <button class="favorite-button" id="favoriteButton" onclick="toggleFavorite()">‚≠ê –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</button>
    </div>
  </div>

  <div class="profile-section">
    <div class="profile-section-title">–û –°–ï–ë–ï</div>
    <div class="profile-bio" id="modalBio">–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫, —Å–æ–∑–¥–∞—Ç–µ–ª—å.</div>
  </div>

  <div class="profile-section">
    <div class="profile-section-title">–ú–£–ó–´–ö–ê</div>
    <div id="modalMusicList">
      <div class="profile-music-item">
        <div class="music-icon">üéµ</div>
        <div class="music-info">
          <div class="music-title">Buckshot Roulette</div>
          <div class="music-artist">Elliot Malik</div>
        </div>
      </div>
    </div>
  </div>

  <!-- –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è —Å–≤–æ–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è) -->
  <div id="editMode" style="display: none;">
    <div class="edit-field">
      <label>–û–ü–ò–°–ê–ù–ò–ï</label>
      <textarea id="editBioInput" placeholder="–†–∞—Å—Å–∫–∞–∂–∏ –æ —Å–µ–±–µ..." rows="3">–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫, —Å–æ–∑–¥–∞—Ç–µ–ª—å.</textarea>
    </div>
    <div class="edit-field">
      <label>–°–°–´–õ–ö–ê –ù–ê –ú–£–ó–´–ö–£</label>
      <input type="text" id="editMusicInput" placeholder="https://...">
    </div>
    <div class="edit-field">
      <label>–ù–ê–ó–í–ê–ù–ò–ï –¢–†–ï–ö–ê</label>
      <input type="text" id="editMusicTitle" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" value="Buckshot Roulette">
    </div>
    <div class="edit-field">
      <label>–ò–°–ü–û–õ–ù–ò–¢–ï–õ–¨</label>
      <input type="text" id="editMusicArtist" placeholder="–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å" value="Elliot Malik">
    </div>
    <button class="btn small" onclick="saveProfile()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    <button class="btn small" onclick="cancelEdit()" style="background: #333; color: #fff;">–û—Ç–º–µ–Ω–∞</button>
  </div>

  <button class="btn small" id="editProfileBtn" onclick="startEdit()" style="margin-top: 20px;">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
  <button class="btn small" onclick="closeProfileModal()" style="margin-top: 10px; background: #333; color: #fff;">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>

<!-- –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ -->
<div class="welcome-screen" id="welcomeScreen">
  <div class="auth-card">
    <div class="logo">
      <span>NOQEDER</span>
    </div>
    
    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∫–∏ -->
    <div class="avatar-upload">
      <div class="avatar-preview" id="avatarPreview" onclick="document.getElementById('avatarInput').click()">
        <div class="avatar-placeholder" id="avatarPlaceholder">+</div>
        <img id="avatarImage" src="" style="display: none;">
      </div>
      <div class="avatar-hint">–ù–∞–∂–º–∏, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ</div>
      <input type="file" id="avatarInput" accept="image/*" style="display: none;">
    </div>

    <div class="input-group">
      <label>–Æ–ó–ï–†–ù–ï–ô–ú</label>
      <input id="username" placeholder="@username">
    </div>
    <div class="input-group">
      <label>–ü–ê–†–û–õ–¨</label>
      <input type="password" id="password">
    </div>
    <button class="btn" onclick="login()">–í–æ–π—Ç–∏</button>
  </div>
</div>

<!-- –û—Å–Ω–æ–≤–Ω–æ–π —á–∞—Ç -->
<div class="chat-container hidden" id="chatContainer">
  <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
  <div class="chats-sidebar">
    <div class="sidebar-header">
      <h2><span>NOQEDER</span></h2>
      <div class="icon-btn rotating" onclick="openSettings()">‚öôÔ∏è</div>
    </div>

    <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div class="user-card" id="userCard" onclick="showMyProfile()">
      <div class="user-avatar" id="userAvatar">
        <img src="" id="userAvatarImg">
      </div>
      <div class="user-info">
        <div class="user-name" id="userName"></div>
        <div class="user-username" id="userUsername"></div>
        <div class="user-bio" id="userBioDisplay">–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫, —Å–æ–∑–¥–∞—Ç–µ–ª—å.</div>
        <div class="user-music" id="userMusicDisplay">üéµ Buckshot Roulette</div>
      </div>
    </div>

    <!-- –ò–∑–±—Ä–∞–Ω–Ω–æ–µ -->
    <div class="favorites-section">
      <div class="favorites-title">
        <span>‚≠ê –ò–ó–ë–†–ê–ù–ù–û–ï</span>
        <span id="favoritesCount">0</span>
      </div>
      <div class="favorites-list" id="favoritesList"></div>
    </div>

    <!-- –ü–æ–∏—Å–∫ -->
    <div class="search-section">
      <div class="search-title">–ù–ê–ô–¢–ò –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø</div>
      <div class="search-container">
        <span class="search-icon">üîç</span>
        <input type="text" class="search-input" id="searchInput" placeholder="@username" oninput="searchUsers()">
      </div>
      <div class="search-results" id="searchResults"></div>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ -->
    <div class="chats-list" id="chatsList"></div>
  </div>

  <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å -->
  <div class="chat-main">
    <div class="chat-header">
      <div class="header-left" onclick="showCurrentChatProfile()">
        <div class="user-avatar small" id="chatAvatar">
          <img src="" id="chatAvatarImg">
        </div>
        <span id="chatTitle">–û–±—â–∏–π —á–∞—Ç</span>
        <span class="star" id="chatFavoriteStar" style="display: none;">‚≠ê</span>
      </div>
      <div class="header-icons">
        <div class="icon-btn bouncing" onclick="startCall()">üìû</div>
      </div>
    </div>

    <div class="messages-area" id="messagesArea">
      <div class="system-message">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Noqeder</div>
    </div>

    <div class="composer">
      <!-- –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã -->
      <div class="composer-tools">
        <div class="media-btn" onclick="document.getElementById('fileInput').click()">üìÅ</div>
        <div class="media-btn" onclick="document.getElementById('imageInput').click()">üñºÔ∏è</div>
        <div class="media-btn" onclick="document.getElementById('videoInput').click()">üé•</div>
      </div>

      <!-- –°–∫—Ä—ã—Ç—ã–µ –∏–Ω–ø—É—Ç—ã -->
      <input type="file" id="fileInput" style="display: none" onchange="handleFileSelect(this.files[0])">
      <input type="file" id="imageInput" style="display: none" accept="image/*" onchange="handleFileSelect(this.files[0])">
      <input type="file" id="videoInput" style="display: none" accept="video/*" onchange="handleFileSelect(this.files[0])">

      <!-- –ü—Ä–µ–≤—å—é -->
      <div class="upload-preview hidden" id="uploadPreview">
        <div class="file-icon">üìÑ</div>
        <div class="preview-info">
          <div class="preview-name" id="previewName"></div>
          <div class="preview-size" id="previewSize"></div>
        </div>
        <button class="preview-cancel" onclick="cancelUpload()">‚úï</button>
      </div>

      <!-- –ü–æ–ª–µ –≤–≤–æ–¥–∞ -->
      <div class="composer-row">
        <input id="messageInput" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ" autocomplete="off">
        <button onclick="sendMessage()">‚Üí</button>
      </div>
    </div>
  </div>
</div>

<script>
  const socket = io();
  let currentUser = null;
  let currentFile = null;
  let users = [];
  let chats = [];
  let selectedChat = null;
  let favorites = JSON.parse(localStorage.getItem('favorites')) || [];

  // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
  let settings = JSON.parse(localStorage.getItem('settings')) || {
    privacy: {
      online: 'all',
      calls: 'all',
      messages: 'all'
    },
    calls: {
      mic: true,
      sound: true,
      autoAccept: false
    },
    language: 'ru',
    personalization: {
      theme: 'dark',
      notifications: true,
      animations: true
    }
  };

  // –î–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è
  let profileBio = localStorage.getItem('profileBio') || '–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫, —Å–æ–∑–¥–∞—Ç–µ–ª—å.';
  let profileMusic = JSON.parse(localStorage.getItem('profileMusic')) || {
    title: 'Buckshot Roulette',
    artist: 'Elliot Malik',
    url: ''
  };

  // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
  const welcomeScreen = document.getElementById('welcomeScreen');
  const chatContainer = document.getElementById('chatContainer');
  const messagesArea = document.getElementById('messagesArea');
  const messageInput = document.getElementById('messageInput');
  const uploadPreview = document.getElementById('uploadPreview');
  const previewName = document.getElementById('previewName');
  const previewSize = document.getElementById('previewSize');
  const userCard = document.getElementById('userCard');
  const userName = document.getElementById('userName');
  const userUsername = document.getElementById('userUsername');
  const userAvatarImg = document.getElementById('userAvatarImg');
  const chatAvatarImg = document.getElementById('chatAvatarImg');
  const chatTitle = document.getElementById('chatTitle');
  const userBioDisplay = document.getElementById('userBioDisplay');
  const userMusicDisplay = document.getElementById('userMusicDisplay');
  const favoritesList = document.getElementById('favoritesList');
  const favoritesCount = document.getElementById('favoritesCount');
  const chatFavoriteStar = document.getElementById('chatFavoriteStar');

  // –ú–æ–¥–∞–ª–∫–∏
  const profileOverlay = document.getElementById('profileOverlay');
  const profileModal = document.getElementById('profileModal');
  const modalName = document.getElementById('modalName');
  const modalUsername = document.getElementById('modalUsername');
  const modalAvatarImg = document.getElementById('modalAvatarImg');
  const modalBio = document.getElementById('modalBio');
  const modalMusicList = document.getElementById('modalMusicList');
  const modalFavoriteBadge = document.getElementById('modalFavoriteBadge');
  const favoriteButton = document.getElementById('favoriteButton');
  const editMode = document.getElementById('editMode');
  const editProfileBtn = document.getElementById('editProfileBtn');
  const editBioInput = document.getElementById('editBioInput');
  const editMusicInput = document.getElementById('editMusicInput');
  const editMusicTitle = document.getElementById('editMusicTitle');
  const editMusicArtist = document.getElementById('editMusicArtist');

  // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
  const settingsOverlay = document.getElementById('settingsOverlay');
  const settingsModal = document.getElementById('settingsModal');
  const privacyOnline = document.getElementById('privacyOnline');
  const privacyCalls = document.getElementById('privacyCalls');
  const privacyMessages = document.getElementById('privacyMessages');
  const micToggle = document.getElementById('micToggle');
  const soundToggle = document.getElementById('soundToggle');
  const autoAcceptToggle = document.getElementById('autoAcceptToggle');
  const languageSelect = document.getElementById('languageSelect');
  const themeSelect = document.getElementById('themeSelect');
  const notificationsToggle = document.getElementById('notificationsToggle');
  const animationsToggle = document.getElementById('animationsToggle');

  // ==================== –ê–í–ê–¢–ê–†–ö–ê ====================
  document.getElementById('avatarInput').onchange = function(e) {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        document.getElementById('avatarPlaceholder').style.display = 'none';
        const avatarImage = document.getElementById('avatarImage');
        avatarImage.src = e.target.result;
        avatarImage.style.display = 'block';
        localStorage.setItem('tempAvatar', e.target.result);
      };
      reader.readAsDataURL(file);
    }
  };

  // ==================== –ù–ê–°–¢–†–û–ô–ö–ò ====================
  function openSettings() {
    loadSettings();
    settingsOverlay.classList.add('active');
    settingsModal.classList.add('active');
  }

  function closeSettings() {
    settingsOverlay.classList.remove('active');
    settingsModal.classList.remove('active');
  }

  function loadSettings() {
    privacyOnline.value = settings.privacy.online;
    privacyCalls.value = settings.privacy.calls;
    privacyMessages.value = settings.privacy.messages;
    
    micToggle.classList.toggle('active', settings.calls.mic);
    soundToggle.classList.toggle('active', settings.calls.sound);
    autoAcceptToggle.classList.toggle('active', settings.calls.autoAccept);
    
    languageSelect.value = settings.language;
    themeSelect.value = settings.personalization.theme;
    notificationsToggle.classList.toggle('active', settings.personalization.notifications);
    animationsToggle.classList.toggle('active', settings.personalization.animations);
  }

  function toggleSetting(type) {
    switch(type) {
      case 'mic':
        settings.calls.mic = !settings.calls.mic;
        micToggle.classList.toggle('active', settings.calls.mic);
        break;
      case 'sound':
        settings.calls.sound = !settings.calls.sound;
        soundToggle.classList.toggle('active', settings.calls.sound);
        break;
      case 'autoAccept':
        settings.calls.autoAccept = !settings.calls.autoAccept;
        autoAcceptToggle.classList.toggle('active', settings.calls.autoAccept);
        break;
      case 'notifications':
        settings.personalization.notifications = !settings.personalization.notifications;
        notificationsToggle.classList.toggle('active', settings.personalization.notifications);
        break;
      case 'animations':
        settings.personalization.animations = !settings.personalization.animations;
        animationsToggle.classList.toggle('active', settings.personalization.animations);
        break;
    }
  }

  function saveSettings() {
    settings.privacy.online = privacyOnline.value;
    settings.privacy.calls = privacyCalls.value;
    settings.privacy.messages = privacyMessages.value;
    settings.language = languageSelect.value;
    settings.personalization.theme = themeSelect.value;
    
    localStorage.setItem('settings', JSON.stringify(settings));
    
    if (settings.personalization.theme === 'light') {
      document.body.style.background = '#f5f5f7';
      document.body.style.color = '#000';
    } else {
      document.body.style.background = '#0a0a0c';
      document.body.style.color = '#fff';
    }
    
    alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
    closeSettings();
  }

  // ==================== –ò–ó–ë–†–ê–ù–ù–û–ï ====================
  function toggleFavorite() {
    const userId = modalName.getAttribute('data-user-id');
    if (!userId) return;

    const index = favorites.indexOf(userId);
    if (index === -1) {
      favorites.push(userId);
      favoriteButton.textContent = '‚≠ê –í –∏–∑–±—Ä–∞–Ω–Ω–æ–º';
      favoriteButton.classList.add('active');
      modalFavoriteBadge.style.display = 'flex';
    } else {
      favorites.splice(index, 1);
      favoriteButton.textContent = '‚≠ê –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ';
      favoriteButton.classList.remove('active');
      modalFavoriteBadge.style.display = 'none';
    }

    localStorage.setItem('favorites', JSON.stringify(favorites));
    updateFavoritesList();
    updateChatsList();

    if (selectedChat && selectedChat.user.id === userId) {
      chatFavoriteStar.style.display = favorites.includes(userId) ? 'inline' : 'none';
    }
  }

  function isFavorite(userId) {
    return favorites.includes(userId);
  }

  function updateFavoritesList() {
    const favUsers = users.filter(u => favorites.includes(u.id) && u.id !== currentUser?.id);
    favoritesCount.textContent = favUsers.length;

    if (favUsers.length === 0) {
      favoritesList.innerHTML = '<div class="favorite-item" style="justify-content: center; color: #666;">–ù–µ—Ç –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö</div>';
      return;
    }

    favoritesList.innerHTML = favUsers.map(user => `
      <div class="favorite-item" onclick="startChat('${user.id}')">
        <span class="favorite-star">‚≠ê</span>
        <div class="user-avatar small"><img src="${user.avatar}"></div>
        <div class="chat-info">
          <div class="chat-name">${user.name}</div>
          <div class="chat-last-message">@${user.username}</div>
        </div>
      </div>
    `).join('');
  }

  // ==================== –ü–†–û–§–ò–õ–¨ ====================
  function showMyProfile() {
    modalName.textContent = currentUser.name;
    modalName.setAttribute('data-user-id', currentUser.id);
    modalUsername.textContent = '@' + currentUser.username;
    modalAvatarImg.src = currentUser.avatar;
    modalBio.textContent = profileBio;
    
    const isFav = isFavorite(currentUser.id);
    modalFavoriteBadge.style.display = isFav ? 'flex' : 'none';
    
    updateMusicDisplay(profileMusic);
    
    favoriteButton.textContent = isFav ? '‚≠ê –í –∏–∑–±—Ä–∞–Ω–Ω–æ–º' : '‚≠ê –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ';
    favoriteButton.classList.toggle('active', isFav);
    favoriteButton.style.display = 'block';
    
    editProfileBtn.style.display = 'block';
    profileOverlay.classList.add('active');
    profileModal.classList.add('active');
  }

  function showUserProfile(user) {
    modalName.textContent = user.name;
    modalName.setAttribute('data-user-id', user.id);
    modalUsername.textContent = '@' + user.username;
    modalAvatarImg.src = user.avatar;
    modalBio.textContent = user.bio || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–∫–∞ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–ø–∏—Å–∞–ª';
    
    const isFav = isFavorite(user.id);
    modalFavoriteBadge.style.display = isFav ? 'flex' : 'none';
    
    if (user.music && user.music.title) {
      updateMusicDisplay(user.music);
    } else {
      modalMusicList.innerHTML = '<div class="profile-music-item">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –¥–æ–±–∞–≤–∏–ª –º—É–∑—ã–∫—É</div>';
    }
    
    favoriteButton.textContent = isFav ? '‚≠ê –í –∏–∑–±—Ä–∞–Ω–Ω–æ–º' : '‚≠ê –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ';
    favoriteButton.classList.toggle('active', isFav);
    favoriteButton.style.display = 'block';
    
    editProfileBtn.style.display = 'none';
    profileOverlay.classList.add('active');
    profileModal.classList.add('active');
  }

  function showCurrentChatProfile() {
    if (selectedChat) {
      showUserProfile(selectedChat.user);
    }
  }

  function closeProfileModal() {
    profileOverlay.classList.remove('active');
    profileModal.classList.remove('active');
    editMode.style.display = 'none';
    editProfileBtn.style.display = 'block';
  }

  function startEdit() {
    editBioInput.value = profileBio;
    editMusicTitle.value = profileMusic.title || '';
    editMusicArtist.value = profileMusic.artist || '';
    editMusicInput.value = profileMusic.url || '';
    
    editMode.style.display = 'block';
    editProfileBtn.style.display = 'none';
  }

  function cancelEdit() {
    editMode.style.display = 'none';
    editProfileBtn.style.display = 'block';
  }

  function saveProfile() {
    profileBio = editBioInput.value.trim();
    profileMusic = {
      title: editMusicTitle.value.trim(),
      artist: editMusicArtist.value.trim(),
      url: editMusicInput.value.trim()
    };
    
    localStorage.setItem('profileBio', profileBio);
    localStorage.setItem('profileMusic', JSON.stringify(profileMusic));
    
    modalBio.textContent = profileBio;
    updateMusicDisplay(profileMusic);
    
    userBioDisplay.innerHTML = `üìù ${profileBio.substring(0, 30)}${profileBio.length > 30 ? '...' : ''}`;
    userBioDisplay.style.display = 'flex';
    
    if (profileMusic.title) {
      userMusicDisplay.innerHTML = `üéµ ${profileMusic.title}`;
      userMusicDisplay.style.display = 'flex';
    }
    
    if (currentUser) {
      currentUser.bio = profileBio;
      currentUser.music = profileMusic;
      socket.emit('update-profile', currentUser);
    }
    
    editMode.style.display = 'none';
    editProfileBtn.style.display = 'block';
  }

  function updateMusicDisplay(music) {
    if (music && music.title) {
      modalMusicList.innerHTML = `
        <div class="profile-music-item">
          <div class="music-icon">üéµ</div>
          <div class="music-info">
            <div class="music-title">${music.title}</div>
            <div class="music-artist">${music.artist || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å'}</div>
          </div>
          ${music.url ? `<button class="music-play" onclick="window.open('${music.url}')">‚ñ∂</button>` : ''}
        </div>
      `;
    } else {
      modalMusicList.innerHTML = `
        <div class="profile-music-item" onclick="startEdit()">
          <div class="music-icon">üéµ</div>
          <div class="music-info">
            <div class="music-title">–î–æ–±–∞–≤–∏—Ç—å –º—É–∑—ã–∫—É</div>
            <div class="music-artist">–ù–∞–∂–º–∏, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–∫</div>
          </div>
          <button class="music-play">+</button>
        </div>
      `;
    }
  }

  // ==================== –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ====================
  function login() {
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value;

    if (!username || !password) {
      alert('–ó–∞–ø–æ–ª–Ω–∏ –≤—Å–µ –ø–æ–ª—è');
      return;
    }

    const avatar = localStorage.getItem('tempAvatar') || 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'100\' height=\'100\'%3E%3Ccircle cx=\'50\' cy=\'50\' r=\'50\' fill=\'%232a2a35\'/%3E%3Ctext x=\'50\' y=\'65\' font-size=\'40\' text-anchor=\'middle\' fill=\'%23fff\' dy=\'.3em\'%3EN%3C/text%3E%3C/svg%3E';

    currentUser = {
      id: socket.id,
      name: username,
      username: username,
      avatar: avatar,
      bio: profileBio,
      music: profileMusic
    };

    socket.emit('new-user', currentUser);

    welcomeScreen.classList.add('hidden');
    chatContainer.classList.remove('hidden');
    
    userCard.classList.remove('hidden');
    userName.textContent = username;
    userUsername.textContent = '@' + username;
    userAvatarImg.src = avatar;
    
    userBioDisplay.innerHTML = `üìù ${profileBio}`;
    if (profileMusic.title) {
      userMusicDisplay.innerHTML = `üéµ ${profileMusic.title}`;
    }
    
    updateFavoritesList();
    
    localStorage.removeItem('tempAvatar');
  }

  // ==================== –§–ê–ô–õ–´ ====================
  function handleFileSelect(file) {
    if (!file) return;
    currentFile = file;
    previewName.textContent = file.name;
    previewSize.textContent = formatFileSize(file.size);
    uploadPreview.classList.remove('hidden');
  }

  function cancelUpload() {
    currentFile = null;
    uploadPreview.classList.add('hidden');
  }

  function formatFileSize(bytes) {
    if (bytes === 0) return '0 –ë';
    const k = 1024;
    const sizes = ['–ë', '–ö–ë', '–ú–ë', '–ì–ë'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
  }

  // ==================== –ü–û–ò–°–ö ====================
  function searchUsers() {
    const query = document.getElementById('searchInput').value.trim().toLowerCase();
    const results = document.getElementById('searchResults');
    
    if (!query) {
      results.innerHTML = '';
      return;
    }

    const found = users.filter(u => 
      u.id !== currentUser?.id && 
      u.username && 
      u.username.toLowerCase().includes(query)
    );

    if (found.length === 0) {
      results.innerHTML = '<div class="search-result-item" style="justify-content: center;">–ù–∏–∫–æ–≥–æ –Ω–µ—Ç</div>';
      return;
    }

    results.innerHTML = found.map(u => `
      <div class="search-result-item" onclick="startChat('${u.id}')">
        <div class="user-avatar small"><img src="${u.avatar}"></div>
        <div style="flex: 1;">
          <div style="font-weight:500">${u.name}</div>
          <div style="font-size:12px; color:#888">@${u.username}</div>
        </div>
        ${isFavorite(u.id) ? '<span class="search-result-favorite">‚≠ê</span>' : ''}
      </div>
    `).join('');
  }

  // ==================== –ß–ê–¢–´ ====================
  function startChat(userId) {
    const user = users.find(u => u.id === userId);
    if (!user) return;

    let chat = chats.find(c => c.user.id === userId);
    if (!chat) {
      chat = {
        id: 'chat_' + Date.now(),
        user: user,
        messages: [],
        lastMessage: ''
      };
      chats.unshift(chat);
    }

    selectedChat = chat;
    updateChatsList();
    showChat(chat);
    
    chatFavoriteStar.style.display = isFavorite(userId) ? 'inline' : 'none';
    
    document.getElementById('searchInput').value = '';
    document.getElementById('searchResults').innerHTML = '';
  }

  function updateChatsList() {
    const list = document.getElementById('chatsList');
    list.innerHTML = chats.map(c => {
      const isFav = isFavorite(c.user.id);
      return `
        <div class="chat-item ${selectedChat?.id === c.id ? 'selected' : ''} ${isFav ? 'favorite' : ''}" onclick="selectChat('${c.id}')">
          <div class="user-avatar small"><img src="${c.user.avatar}"></div>
          <div class="chat-info">
            <div class="chat-name">
              ${c.user.name}
              ${isFav ? '<span class="star">‚≠ê</span>' : ''}
            </div>
            <div class="chat-last-message">${c.lastMessage || '–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π'}</div>
          </div>
        </div>
      `;
    }).join('');
  }

  function selectChat(chatId) {
    const chat = chats.find(c => c.id === chatId);
    if (chat) {
      selectedChat = chat;
      showChat(chat);
      chatFavoriteStar.style.display = isFavorite(chat.user.id) ? 'inline' : 'none';
    }
  }

  function showChat(chat) {
    chatTitle.textContent = chat.user.name;
    chatAvatarImg.src = chat.user.avatar;
    
    messagesArea.innerHTML = '<div class="system-message">–ß–∞—Ç —Å @' + chat.user.username + '</div>';
    chat.messages.forEach(msg => addMessage(msg));
  }

  // ==================== –û–¢–ü–†–ê–í–ö–ê ====================
  function sendMessage() {
    const text = messageInput.value.trim();

    if (currentFile) {
      sendFile(currentFile);
      cancelUpload();
    } else if (text && currentUser) {
      const msg = {
        type: 'text',
        text: text,
        user: currentUser,
        time: new Date().toLocaleTimeString()
      };

      if (selectedChat) {
        msg.to = selectedChat.user;
        socket.emit('private-message', msg);
        
        selectedChat.messages.push(msg);
        selectedChat.lastMessage = text;
        updateChatsList();
        addMessage(msg);
      } else {
        socket.emit('message', msg);
        addMessage(msg);
      }
      
      messageInput.value = '';
    }
  }

  function sendFile(file) {
    const reader = new FileReader();

    reader.onload = function(e) {
      const fileData = {
        name: file.name,
        size: file.size,
        type: file.type,
        data: e.target.result,
        user: currentUser
      };

      let messageType = 'file';
      if (file.type.startsWith('image/')) messageType = 'image';
      else if (file.type.startsWith('video/')) messageType = 'video';

      const msg = {
        type: messageType,
        file: fileData,
        user: currentUser,
        time: new Date().toLocaleTimeString()
      };

      if (selectedChat) {
        msg.to = selectedChat.user;
        socket.emit('private-message', msg);
        
        selectedChat.messages.push(msg);
        selectedChat.lastMessage = 'üìé ' + file.name;
        updateChatsList();
        addMessage(msg);
      } else {
        socket.emit('message', msg);
        addMessage(msg);
      }
    };

    reader.readAsDataURL(file);
  }

  // ==================== –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï ====================
  function addMessage(msg) {
    const div = document.createElement('div');
    const isOwn = currentUser && msg.user.id === currentUser.id;
    div.className = `message ${isOwn ? 'own' : ''}`;

    let contentHtml = '';

    if (msg.type === 'text' || !msg.type) {
      contentHtml = `<div>${msg.text || msg}</div>`;
    } else if (msg.type === 'image') {
      contentHtml = `
        <div class="file-message">
          <div class="file-icon">üñºÔ∏è</div>
          <div class="file-info">
            <div class="file-name">${msg.file.name}</div>
            <div class="file-size">${formatFileSize(msg.file.size)}</div>
          </div>
          <a href="${msg.file.data}" download="${msg.file.name}" class="file-download">–°–∫–∞—á–∞—Ç—å</a>
        </div>
        <img src="${msg.file.data}" class="message-image" onclick="window.open(this.src)">
      `;
    } else if (msg.type === 'video') {
      contentHtml = `
        <div class="file-message">
          <div class="file-icon">üé•</div>
          <div class="file-info">
            <div class="file-name">${msg.file.name}</div>
            <div class="file-size">${formatFileSize(msg.file.size)}</div>
          </div>
          <a href="${msg.file.data}" download="${msg.file.name}" class="file-download">–°–∫–∞—á–∞—Ç—å</a>
        </div>
        <video src="${msg.file.data}" class="message-video" controls></video>
      `;
    } else {
      contentHtml = `
        <div class="file-message">
          <div class="file-icon">üìÑ</div>
          <div class="file-info">
            <div class="file-name">${msg.file.name}</div>
            <div class="file-size">${formatFileSize(msg.file.size)}</div>
          </div>
          <a href="${msg.file.data}" download="${msg.file.name}" class="file-download">–°–∫–∞—á–∞—Ç—å</a>
        </div>
      `;
    }

    div.innerHTML = `
      <div class="message-avatar" onclick="showUserProfileFromMessage('${msg.user.id}')"><img src="${msg.user.avatar}" alt="avatar"></div>
      <div class="message-content">
        <div class="message-author" onclick="showUserProfileFromMessage('${msg.user.id}')">${msg.user.name}</div>
        ${contentHtml}
        <div class="message-time">${msg.time || ''}</div>
      </div>
    `;

    messagesArea.appendChild(div);
    messagesArea.scrollTop = messagesArea.scrollHeight;
  }

  function showUserProfileFromMessage(userId) {
    const user = users.find(u => u.id === userId);
    if (user && user.id !== currentUser.id) {
      showUserProfile(user);
    } else if (user && user.id === currentUser.id) {
      showMyProfile();
    }
  }

  // ==================== –ó–í–û–ù–ö–ò ====================
  function startCall() {
    alert('–ó–≤–æ–Ω–∫–∏ –ø–æ—è–≤—è—Ç—Å—è —Å–∫–æ—Ä–æ');
  }

  // ==================== –°–û–ö–ï–¢–´ ====================
  socket.on('users', (data) => {
    users = data;
    updateFavoritesList();
  });

  socket.on('message', (msg) => {
    addMessage(msg);
  });

  socket.on('private-message', (msg) => {
    const from = msg.from.id === currentUser.id ? msg.to : msg.from;
    
    let chat = chats.find(c => c.user.id === from.id);
    
    if (!chat) {
      chat = {
        id: 'chat_' + Date.now(),
        user: from,
        messages: [msg],
        lastMessage: msg.type === 'text' ? msg.text : 'üìé ' + msg.file.name
      };
      chats.unshift(chat);
    } else {
      chat.messages.push(msg);
      chat.lastMessage = msg.type === 'text' ? msg.text : 'üìé ' + msg.file.name;
      const index = chats.indexOf(chat);
      if (index > 0) {
        chats.splice(index, 1);
        chats.unshift(chat);
      }
    }

    updateChatsList();
    if (selectedChat?.user.id === from.id) addMessage(msg);
  });

  socket.on('history', (msgs) => {
    messagesArea.innerHTML = '<div class="system-message">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Noqeder</div>';
    msgs.forEach(addMessage);
  });

  socket.on('update-profile', (user) => {
    const index = users.findIndex(u => u.id === user.id);
    if (index !== -1) {
      users[index].bio = user.bio;
      users[index].music = user.music;
    }
    
    const chatIndex = chats.findIndex(c => c.user.id === user.id);
    if (chatIndex !== -1) {
      chats[chatIndex].user.bio = user.bio;
      chats[chatIndex].user.music = user.music;
    }
  });

  // ==================== –°–û–ë–´–¢–ò–Ø ====================
  messageInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') sendMessage();
  });

  messageInput.addEventListener('input', () => {
    if (messageInput.value.trim() && currentFile) {
      cancelUpload();
    }
  });

  // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–º—É
  if (settings.personalization.theme === 'light') {
    document.body.style.background = '#f5f5f7';
    document.body.style.color = '#000';
  }
</script>

</body>
</html>
